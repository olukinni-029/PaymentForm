<!DOCTYPE html>
<html>
<head>
<title>Payment-section</title>
<base href="/" />
<style>
* {
  box-sizing: border-box;
  font-family: Arial, sans-serif;
}

body {
  background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
  min-height: 100vh;
  margin: 0;
  padding: 20px;
  display: flex;
  justify-content: center;
  align-items: center;
}

.form-container {
  background: white;
  padding: 30px;
  border-radius: 10px;
  box-shadow: 0 10px 20px rgba(0,0,0,0.1);
  width: 100%;
  max-width: 600px;
}

h2 {
  color: #333;
  text-align: center;
  margin-bottom: 30px;
}

.form-group {
  margin-bottom: 20px;
}

label {
  display: block;
  margin-bottom: 5px;
  color: #555;
  font-weight: bold;
}

input, select {
  width: 100%;
  padding: 10px;
  border: 1px solid #ddd;
  border-radius: 5px;
  font-size: 16px;
}

.card-details {
  display: grid;
  grid-template-columns: 2fr 1fr 1fr;
  gap: 15px;
}

button {
  background: #4CAF50;
  color: white;
  padding: 12px 20px;
  border: none;
  border-radius: 5px;
  width: 100%;
  font-size: 16px;
  cursor: pointer;
  transition: background 0.3s ease;
}

button:hover {
  background: #45a049;
}

.error {
  color: #ff0000;
  font-size: 14px;
  margin-top: 5px;
  display: none; /* Initially hide error messages */
}
</style>
</head>
<body>

<div class="form-container">
  <h2>Payment Form</h2>
  <form id="paymentForm" onsubmit="return validateForm(event)">
    <!-- Personal Information -->
    <div class="form-group">
      <label for="fullName">Full Name</label>
      <input type="text" id="fullName" required>
      <div class="error" id="nameError">Please enter your full name</div>
    </div>

    <div class="form-group">
      <label for="email">Email</label>
      <input type="email" id="email" required>
      <div class="error" id="emailError">Please enter a valid email address</div>
    </div>

    <!-- Billing Address -->
    <div class="form-group">
      <label for="address">Street Address</label>
      <input type="text" id="address" required>
    </div>

    <div class="form-group">
      <label for="city">City</label>
      <input type="text" id="city" required>
    </div>

    <div class="form-group">
      <label for="state">State</label>
      <input type="text" id="state" required>
    </div>

    <div class="form-group">
      <label for="zip">ZIP Code</label>
      <input type="text" id="zip" required pattern="[0-9]{6}">
      <div class="error" id="zipError">Please enter a valid 6-digit ZIP code</div>
    </div>

    <!-- Card Information -->
    <div class="form-group">
      <label for="cardNumber">Card Number</label>
      <input type="text" id="cardNumber" required pattern="[0-9]{16}" maxlength="16">
      <div class="error" id="cardError">Please enter a valid 16-digit card number</div>
    </div>

    <div class="card-details">
      <div class="form-group">
        <label for="cardName">Name on Card</label>
        <input type="text" id="cardName" required>
      </div>

      <div class="form-group">
        <label for="expiry">Expiry</label>
        <input type="text" id="expiry" placeholder="MM/YY" required pattern="(0[1-9]|1[0-2])\/([0-9]{2})" maxlength="5">
      </div>

      <div class="form-group">
        <label for="cvv">CVV</label>
        <input type="text" id="cvv" required pattern="[0-9]{3,4}" maxlength="4">
      </div>
    </div>

    <button type="submit">Submit Payment</button>
  </form>
</div>

<script>
function validateForm(event) {
  event.preventDefault();

  // Reset errors
  document.querySelectorAll('.error').forEach(error => error.style.display = 'none');

  let isValid = true;

  // Validate full name
  const fullName = document.getElementById('fullName');
  if (!fullName.value.trim()) {
    document.getElementById('nameError').style.display = 'block';
    isValid = false;
  }

  // Validate email
  const email = document.getElementById('email');
  if (!email.value.match(/^[^\s@]+@[^\s@]+\.[^\s@]+$/)) {
    document.getElementById('emailError').style.display = 'block';
    isValid = false;
  }

  // Validate ZIP
  const zip = document.getElementById('zip');
  if (!zip.value.match(/^[0-9]{6}$/)) {
    document.getElementById('zipError').style.display = 'block';
    isValid = false;
  }

  // Validate card number
  const cardNumber = document.getElementById('cardNumber');
  if (!cardNumber.value.match(/^[0-9]{16}$/)) {
    document.getElementById('cardError').style.display = 'block';
    isValid = false;
  }

  // If form is valid, submit data
  if (isValid) {
    const formData = {
      fullName: fullName.value,
      email: email.value,
      address: document.getElementById('address').value,
      city: document.getElementById('city').value,
      state: document.getElementById('state').value,
      zip: zip.value,
      cardNumber: cardNumber.value,
      cardName: document.getElementById('cardName').value,
      expiry: document.getElementById('expiry').value,
      cvv: document.getElementById('cvv').value
    };
    
    fetch('http://localhost:3040/submit-payment', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify(formData),
})
  .then(response => {
    if (!response.ok) {
      return response.json().then(err => {
        throw err; // Pass the entire error object to the catch block
      });
    }
    return response.json();
  })
  .then(data => {
    console.log('Response:', data);
    alert(data.message);
    window.location.reload();
  })
  .catch(err => {
    console.error('Error:', err);

    // Check for specific error structure
    if (err.message && err.errors) {
      // Create a detailed error message
      const detailedError = `${err.message}:\n${err.errors.join('\n')}`;
      alert(detailedError); // Display all errors in an alert or elsewhere in the UI

      // Alternatively, display errors in the form
      const errorDiv = document.createElement('div');
      errorDiv.className = 'error';
      errorDiv.innerHTML = `<strong>${err.message}</strong><ul>${err.errors
        .map(e => `<li>${e}</li>`)
        .join('')}</ul>`;
      document.getElementById('paymentForm').prepend(errorDiv);
    } else {
      // Handle unknown error structures
      alert(`Error: ${err.message || 'Unknown error'}`);
    }
  });
  }

  return false;
}

// Prevent non-numeric input where needed
['zip', 'cardNumber', 'cvv'].forEach(id => {
  document.getElementById(id).addEventListener('keypress', function(e) {
    if (!/[0-9]/.test(e.key)) {
      e.preventDefault();
    }
  });
});
</script>

</body>
</html>
