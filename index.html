<!DOCTYPE html>
<html>
<head>
<title>Payment-section</title>
<base href="/" />
<style>
  * {
    box-sizing: border-box;
    font-family: Arial, sans-serif;
  }
  
  body {
    background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
    min-height: 100vh;
    margin: 0;
    padding: 20px;
    display: flex;
    justify-content: center;
    align-items: center;
  }
  
  .form-container {
    background: white;
    padding: 30px;
    border-radius: 10px;
    box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
    width: 100%;
    max-width: 600px;
  }
  
  h2 {
    color: #333;
    text-align: center;
    margin-bottom: 30px;
  }
  
  .form-group {
    margin-bottom: 20px;
  }
  
  label {
    display: block;
    margin-bottom: 5px;
    color: #555;
    font-weight: bold;
  }
  
  input, select {
    width: 100%;
    padding: 10px;
    border: 1px solid #ddd;
    border-radius: 5px;
    font-size: 16px;
  }
  
  .card-details {
    display: grid;
    grid-template-columns: 2fr 1fr 1fr;
    gap: 15px;
  }
  
  button {
    background: #4CAF50;
    color: white;
    padding: 12px 20px;
    border: none;
    border-radius: 5px;
    width: 100%;
    font-size: 16px;
    cursor: pointer;
    transition: background 0.3s ease;
  }
  
  button:hover {
    background: #45a049;
  }
  
  .error {
    color: #ff0000;
    font-size: 14px;
    margin-top: 5px;
    display: none; /* Initially hide error messages */
  }

  /* The Modal (background) */
.modal {
  display: none;
  position: fixed;
  z-index: 1000;
  left: 0;
  top: 0;
  width: 100%;
  height: 100%;
  overflow: auto;
  background-color: rgba(0, 0, 0, 0.5);
  justify-content: center;
  align-items: center;
}

/* Modal Content */
.modal-content {
  background-color: white;
  margin: auto;
  padding: 20px;
  border: 1px solid #888;
  border-radius: 10px;
  width: 80%;
  max-width: 400px;
  text-align: center;
}

/* Close Button */
.close {
  color: #aaa;
  float: right;
  font-size: 28px;
  font-weight: bold;
}

.close:hover,
.close:focus {
  color: black;
  text-decoration: none;
  cursor: pointer;
}

  
  /* Responsive Design */
  @media (max-width: 768px) {
    .form-container {
      padding: 20px;
    }
  
    input, select {
      font-size: 14px;
      padding: 8px;
    }
  
    button {
      font-size: 14px;
      padding: 10px;
    }
  
    .card-details {
      grid-template-columns: 1fr;
      gap: 10px;
    }
  }
  
  @media (max-width: 480px) {
    h2 {
      font-size: 20px;
      margin-bottom: 20px;
    }
  
    input, select {
      font-size: 12px;
      padding: 6px;
    }
  
    button {
      font-size: 12px;
      padding: 8px;
    }
  }
  </style>
  
</head>
<body>

<div class="form-container">
  <h2>Payment Form</h2>
  <form id="paymentForm" onsubmit="return validateForm(event)">
    <!-- Personal Information -->
    <div class="form-group">
      <label for="fullName">Full Name</label>
      <input type="text" id="fullName" required>
      <div class="error" id="nameError">Please enter your full name</div>
    </div>

    <div class="form-group">
      <label for="email">Email</label>
      <input type="email" id="email" required>
      <div class="error" id="emailError">Please enter a valid email address</div>
    </div>

    <!-- Billing Address -->
    <div class="form-group">
      <label for="address">Street Address</label>
      <input type="text" id="address" required>
    </div>

    <div class="form-group">
      <label for="city">City</label>
      <input type="text" id="city" required>
    </div>

    <div class="form-group">
      <label for="state">State</label>
      <input type="text" id="state" required>
    </div>

    <div class="form-group">
      <label for="zip">ZIP Code</label>
      <input type="text" id="zip" required pattern="[0-9]{5,9}">
      <div class="error" id="zipError">Please enter a valid digit between 5 and 9 ZIP code</div>
    </div>

    <!-- Card Information -->
    <div class="form-group">
      <label for="cardNumber">Card Number</label>
      <input type="text" id="cardNumber" required pattern="[0-9]{12,19}" maxlength="16">
      <div class="error" id="cardError">Please enter a valid digit between 12 and 19 card number</div>
    </div>

    <div class="card-details">
      <div class="form-group">
        <label for="cardName">Name on Card</label>
        <input type="text" id="cardName" required>
      </div>

      <div class="form-group">
        <label for="expiry">Expiry</label>
        <input type="text" id="expiry" placeholder="MM/YY" required pattern="(0[1-9]|1[0-2])\/([0-9]{2})" maxlength="">
      </div>

      <div class="form-group">
        <label for="cvv">CVV</label>
        <input type="text" id="cvv" required pattern="[0-9]{3,4}" maxlength="4">
      </div>
    </div>

    <button type="submit">Submit Payment</button>
  </form>
</div>

<div id="responseModal" class="modal">
  <div class="modal-content">
    <span class="close" id="closeModal">&times;</span>
    <p id="modalMessage"></p>
  </div>
</div>


<script>
// Prevent non-numeric input where needed
function preventNonNumericInput() {
  ['zip', 'cardNumber', 'cvv', 'expiry'].forEach((id) => {
    document.getElementById(id).addEventListener('keypress', function (e) {
      if (!/[0-9]/.test(e.key) && e.key !== '/') {
        e.preventDefault();
      }
    });
  });
}

// Format expiry date (MM/YY)
function formatExpiryInput() {
  const expiryInput = document.getElementById('expiry');
  expiryInput.addEventListener('input', (e) => {
    let value = e.target.value;

    // Remove invalid characters
    value = value.replace(/[^0-9\/]/g, '');

    // Automatically add a slash after the first two digits
    if (value.length > 2 && !value.includes('/')) {
      value = value.slice(0, 2) + '/' + value.slice(2);
    }

    // Limit the input to 5 characters
    value = value.slice(0, 5);

    e.target.value = value;
  });
}

// Validate form fields
function validateForm(event) {
  event.preventDefault();

  // Reset errors
  document.querySelectorAll('.error').forEach((error) => (error.style.display = 'none'));

  let isValid = true;

  // Validate full name
  const fullName = document.getElementById('fullName');
  if (!fullName.value.trim()) {
    document.getElementById('nameError').style.display = 'block';
    isValid = false;
  }

  // Validate email
  const email = document.getElementById('email');
  if (!email.value.match(/^[^\s@]+@[^\s@]+\.[^\s@]+$/)) {
    document.getElementById('emailError').style.display = 'block';
    isValid = false;
  }

  // Validate ZIP
  const zip = document.getElementById('zip');
  if (!zip.value.match(/^[0-9]{5,9}$/)) {
    document.getElementById('zipError').style.display = 'block';
    isValid = false;
  }

  // Validate card number
  const cardNumber = document.getElementById('cardNumber');
  if (!cardNumber.value.match(/^[0-9]{12,19}$/)) {
    document.getElementById('cardError').style.display = 'block';
    isValid = false;
  }

  // Validate expiry
  const expiry = document.getElementById('expiry');
  if (!expiry.value.match(/^(0[1-9]|1[0-2])\/([0-9]{2})$/)) {
    document.getElementById('expiryError').style.display = 'block';
    isValid = false;
  }

  // Validate CVV
  const cvv = document.getElementById('cvv');
  if (!cvv.value.match(/^[0-9]{3,4}$/)) {
    document.getElementById('cvvError').style.display = 'block';
    isValid = false;
  }

  // If form is valid, submit data
  if (isValid) {
    const formData = {
      fullName: fullName.value,
      email: email.value,
      address: document.getElementById('address').value,
      city: document.getElementById('city').value,
      state: document.getElementById('state').value,
      zip: zip.value,
      cardNumber: cardNumber.value,
      cardName: document.getElementById('cardName').value,
      expiry: expiry.value,
      cvv: cvv.value,
    };
    const modal = document.getElementById('responseModal');
const modalMessage = document.getElementById('modalMessage');
const closeModal = document.getElementById('closeModal');

// Function to show the modal
function showModal(message) {
  modalMessage.textContent = message;
  modal.style.display = 'flex';
}

// Event listener to close the modal
closeModal.onclick = () => {
  modal.style.display = 'none';
};

// Close modal when clicking outside the modal content
window.onclick = (event) => {
  if (event.target === modal) {
    modal.style.display = 'none';
  }
};

    fetch('https://paymentform-backend.onrender.com/submit-payment', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(formData),
    })
      .then((response) => {
        if (!response.ok) {
          return response.json().then((err) => {
            throw err;
          });
        }
        return response.json();
      })
      .then((data) => {
        console.log('Response:', data);
        showModal(data.message);
        window.location.reload();
      })
      .catch((err) => {
        console.error('Error:', err);

        if (err.message && err.errors) {
          const detailedError = `${err.message}:\n${err.errors.join('\n')}`;
          showModal(detailedError);
        } else {
          showModal(`Error: ${err.message || 'Unknown error'}`);
        }
      });
  }
  return false;
}

// Initialize
preventNonNumericInput();
formatExpiryInput();

</script>

</body>
</html>
